
BBK脚本精解纪念版
    (原名<从0开始学做RPG> 2008年10月23日最后更新(第10次更新)
作者的话:
    大家好,我是深林孤鹰,这是我第一个BBK教程.我现在的水平都归功于<伏魔记>脚本,<校园传奇>脚本,<开发包使用说明.CHM>,<在RPG游戏中显示精确的数值!!!.txt>,<纯蓝教你RPG.chm>,<脚本使用说明.txt>(因为我只有这些东西),我把这些脚本的精华都融会在这篇教程里,希望对大家有所帮助.
    怎样才能成功呢?其实很简单,看一篇教程不是只看一遍,一定要反反复复的看;一是要牢记一些重点;二是不同知识点会在不同地方,反复看才可能明白先前不懂得地方,我看<脚本使用说明.txt>就看了十几遍呢.我建议大家配合<梦幻校园>学习脚本,因为我在其中运用了大量不同脚本写法,专门写了为了学习脚本的游戏,所以忽略了游戏的好玩性.见谅啦...
    另外,这个教程主要针对脚本,对其他没有多说明,现在我把这个教程和开发包使用说明捆在一起,应该是最全面的教程拉(有点不适合初学者...覆盖面是一流哦!),呵呵,当然,只是理论最全面,例子还很少,不过现在有了这么多的RPG游戏,看一辈子脚本也看不完...本人建议还是对照看,这样最有效果.没有特殊很难懂的问题请不要擅自问别人,会给人带来困扰...积极提倡自学成材!
    说一下,这次是最后更新了,不想再做RPG,想学习更新的东西,不过,谁有什么问题我还是回答的,最下面有我的联系方式.我最感兴趣计算机和吉他,有志同道合的朋友可以和我一起来学习,人多力量大嘛.
    这是我抄来的如何学习语言的一些小方法,大家可以看看:
 请不要做浮躁的人
1.不要看到别人的回复第一句话就说：给个代码吧！你应该想想为什么。当你自己想出来再参考别人的提示，你就知道自己和别人思路的差异。
2.初学者请不要看太多太多的书那会误人子弟的，先找本系统的学，很多人用了很久都是只对部分功能熟悉而已，不系统还是不够的。
3.看帮助,不要因为很难而自己是初学者所以就不看；帮助永远是最好的参考手册，虽然帮助的文字有时候很难看懂，总觉得不够直观。
4.不要被对象、属性、方法等词汇所迷惑；最根本的是先了解最基础知识。
5.不要放过任何一个看上去很简单的小问题--他们往往并不那么简单，或者可以引伸出很多知识点；不会举一反三你就永远学不会。
6.知道一点东西，并不能说明你会写脚本，脚本是需要经验积累的。
7.学脚本并不难，JSP、ASP、PHP等等也不过如此--难的是长期坚持实践和不遗余力的博览群书；
8.看再多的书是学不全脚本的，要多实践
9.把时髦的技术挂在嘴边，还不如把过时的技术记在心里；
10.学习脚本最好的方法之一就是多练习；
11.在任何时刻都不要认为自己手中的书已经足够了；
12.看得懂的书，请仔细看；看不懂的书，请硬着头皮看；
13.别指望看第一遍书就能记住和掌握什么――请看第二遍、第三遍；
14.请把书上的例子亲手到电脑上实践，即使配套光盘中有源文件；
15.把在书中看到的有意义的例子扩充；并将其切实的运用到自己的工作中；
16.不要漏掉书中任何一个练习――请全部做完并记录下思路；
17.当你用脚本到一半却发现自己用的方法很拙劣时，请不要马上停手；请尽快将余下的部分粗略的完成以保证这个代码的完整性，然后分析自己的错误并重新编写和工作。
18.别心急，写脚本确实不容易；水平是在不断的实践中完善和发展的；
19.每学到一个脚本难点的时候，尝试着对别人讲解这个知识点并让他理解----你能讲清楚才说明你真的理解了；
20.记录下在和别人交流时发现的自己忽视或不理解的知识点；
21.保存好你做过的所有的源文件----那是你最好的积累之一；
22.对于网络，还是希望大家能多利用一下，很多问题不是非要到论坛来问的，首先你要学会自己找答案，比如google、百度都是很好的搜索引擎，你只要输入关键字就能找到很多相关资料，别老是等别人给你希望，看的出你平时一定也很懒！
23，到一个论坛，你学会去看以前的帖子，不要什么都不看就发帖子问，也许你的问题早就有人问过了，你再问，别人已经不想再重复了，做为初学者，谁也不希望自己的帖子没人回的。
24，虽然不是打击初学者，但是这句话还是要说：论坛论坛，就是大家讨论的地方，如果你总期望有高手总无偿指点你，除非他是你亲戚！！讨论者，起码是水平相当的才有讨论的说法，如果水平真差距太远了，连基本操作都需要别人给解答，谁还跟你讨论呢。
浮躁的人容易问：我到底该学什么；----别问，学就对了；
浮躁的人容易问：JS有钱途吗；----建议你去抢银行；
浮躁的人容易说：我要中文版！我英文不行！----不行？学呀！
浮躁的人分两种：只观望而不学的人；只学而不坚持的人；
浮躁的人永远不是一个高手。
鸣谢:
    苏维埃战士(764608395):提供BUG
    V(603684171):提供BUG
前言:
    本教程适用于BBK(步步高电子词典)RPG游戏开发,侧重于脚本的说明和编写,其他资源介绍请看开发包自带的说明文件.作品可在A系列电子词典或者PC端的模拟器中运行.游戏侧重于剧情和人物刻画,所以基于BBK开发包平台编写,主要由脚本,图片,特效,剧情,其他资源等文件构成,引擎由开发包生成.所以,只需注意以上资源的制作即可.一个程序由数据结构和算法组成,虽然脚本内容及其简单,但是也可以包含很深奥的思想,请不要小看这些代码,能不能制作出成功的游戏还需要灵活运用这些简单的东西组成一个井然有序的有机体系,制作出吸引人的游戏功能.所以,大家不仅要学习代码,更重要的是要学习如何运用代码.本教程全面的涵盖了所有的脚本命令,并且在后面举了比较著名的一些功能例子,希望大家有所成就.本教程由于时间仓促,难免会出现错误,请指正.
----------------------------------------------------------------------------------------------------------------------------
一.学习脚本
1.名词介绍
    (1)操作号:脚本中给对象的临时ID,便于脚本调用(删除释放后可重复用).
    (2)type:类型,用来区分各个资源的种类(特定).所有编辑器中可见到.比如魔法类,地图类...
    (3)index(或team):序号(也可称资源ID),一种资源里的一个对象ID号.所有编辑器中可见到(用户设定).在同一类型中避免重复.比如地图里的MAP1,MAP2...
    (4)地址标号:在同一脚本中,要跳到其他某一命令处执行时的地址号(本身不执行).格式:"名称:".
    (5)变量:在BBK中存放0~255数字的一个量,它的取值取决与最后一次给予的值.注意:变量取值范围是0~255,溢出时会重新从0开始,配合IFCMP或DISCMP命令使用.
    (6)事件标志:和变量不同的是它只有两个值:1和0,变量和事件可以互相代替,但是很繁琐,所以要在合适的地方用会很方便.
    (7)NPC(配角):NPC和场景对象共用的,使用STARTCHAPTER语句载入脚本时会初始化(释放).一般情况下NPC角色和场景对象用法是一样的(也可以理解为地图中可见物体).
    (8)场景事件:包括NPC事件,地图事件(地图中某一坐标出发的事件)和其他事件(SETEVENTTIMER的事件,ENTERFIGHT事件,手动设置事件等).事件触发时用GUTEVENT来指引运行脚本的地址.
2.基础篇
    以下是所有的脚本命令:
'@'为注释符号,同一行@后面的代码无效
@-------------------------------------------------------脚本命令-------------------------------------------------------------
@脚本中可使用的资源:
@1.配角(NPC)资源:可用操作号1~40.
@2.全局变量:可用操作号1~199;局部变量:可用操作号200~239,每次使用STARTCHAPTER语句载入脚本时会初始化.
@3.事件标志:全局,可用操作号1~2400.只在新开始游戏时初始化一次.
@4.场景事件:NPC事件由1~40(与其操作号对应);地图事件由41~255(地图编辑器中设置的事件为x,在场景中的事件为x+40);其他事件可用1到255(注意这些都是共用的,应该避免重复).

@=========媒体播放=========
MUSIC n timers     ---- 播放号码为n(n=1~11)的系统内置音乐(为0时不播放),持续次数为timers(为0时循环播放)
MOVIE type team x y ctl    ---- 播放动画,type和team为参数,(x,y)动画的相对屏幕左上角坐标的偏移,ctl为0时只播放动画,ctl为1时按键动画结束,ctl为2时背景不变,ctl为3时按键动画结束及背景不变(其中TYPE:1表示过场动画,2表示魔法效果.TEAM就是他们所在类型的序号,大家可以打开特效编辑器查看)
@=========游戏场景=========
LOADMAP m n x y     ---- 载入号码n,类型m的地图,初始地图位置(x,y),(x.y)为地图编辑器中load后的坐标(屏幕中最中间的坐标,这就是为什么LOAD和POS差坐标(4,3))
SETSCENENAME "..."    ---- 设置场景名称,五个汉字以内(也用来显示存档名称,但是最好与地图编辑器中名字设置相一致,因为存档名字有时显示这个,有时显示那个,不确定的.当然一副地图多用就算了.)
SHOWSCENENAME     ---- 显示场景名称
SCREENS x y     ---- 屏幕左上角定位到地图的(x,y)处
SHOWSCREEN     ---- 刷新屏幕(因为战斗失败或删除NPC后不能正常显示屏幕,所以一般战斗失败或删除NPC后加上此命令)
@=========游戏角色=========
CREATEACTOR actor x y    ---- 创建主角号码actor,相对屏幕位置为(x,y)注:X=4,Y=3是一个通用坐标,即任何一个地图使用该坐标创建主角时都会在屏幕的正中间
SETCONTROLID actor    ---- 设置角色号actor为当前控制(默认的被控制角色――游戏的主人翁的id=1),也就是设置人物领队
DELETEACTOR actor    ---- 主角角色离队,从角色队列中删除指定主角号码actor的角色(人物属性保存)
CREATENPC id npc x y    ---- 创建配角号码为npc,在地图位置(x,y)处,id为操作号
DELETENPC id     ---- 删除操作号为id的配角
DELALLNPC     ---- 删除当前场景所有NPC和场景对象(每载入一个地图时应加上它)
NPCSTEP id faceto step    ---- id角色(0为主角),faceto面向(分割图片的行数,从0开始,默认为0-3分别代表上右下左),step 脚步(一行中分割图片的号数,从0开始,可以在角色编辑器中查看,默认为0-2分别代表迈左脚,立正,迈右脚;立正最好在中间,因为播放顺序是来回的),此命令也包括场景对象
MOVE id x y     ---- 将操作号为id的NPC角色移动到(x,y)处――主角不可以移动
NPCMOVEMOD id mode    ---- 配角的运动模式,id为操作号,mode为0时原地不动,为1时随机运动,为4激活状态――只换图片,不改变位置(适合动态的物品对象),为2或3没用(NPC原地踏步)
FACETOFACE n m     ---- 角色n与角色m面相对,0为主角
CREATEBOX id boxindex x y   ---- 创建一个场景对象,场景对象图片号码为boxindex,位置为(x,y),id为操作号
BOXOPEN id     ---- 显示场景对象第二张图片(几乎没用,我在NPCSTEP中设置的)
DELETEBOX id     ---- 删除操作号为id的场景对象
@=========脚本调用=========
STARTCHAPTER m n    ---- 载入号为n,类型为m的脚本,当前脚本结束
CALLBACK     ---- 退出脚本(一段命令完时应加上它)
CALLCHAPTER m n     ---- 调用号为n,类型为m的脚本,当前脚本执行位置被保存,所有资源不初始化;当被调用脚本RETURN时,返回调用位置继续执行(注意:调用前后资源都不进行初始化,被调用脚本也会影响调用后的资源状况)
RETURN      ---- 返回到调用位置的下一句(和CALLBACK的区别除了返回区别外,还有一个重要的是本语句会恢复原脚本的事件跳转表等脚本信息)
@=========跳转指令=========
GOTO label     ---- 跳转到脚本地址标号为label处运行
IF n label     ---- 如果事件标志为1,跳转到脚本地址标号为label处运行
GUTEVENT n label    ---- 当角色触发到场景事件n时,跳转到label下执行
IFCMP n m label     ---- 脚标号为n变量与数m相等就跳转到脚本地址标号为label处运行,不等就继续向下
DISCMP n m lowaddr higaddr   ---- 脚标号为n变量与数m,小于数m跳到lowaddr执行脚本,大于数m跳到higaddr执行脚本,等于不跳转
@=========引擎功能调用=========
GAMEOVER     ---- 游戏结束(返回主界面)
SETMONEY money     ---- 设置现钱数目为money
GAINMONEY money     ---- 得到数目为money的钱
USEMONEY money     ---- 用去(丢失)数目为money的钱
BUY "t001 t002 ... tsum"   ---- 买东西,t为物品类型(在道具编辑器中的类型号,1--14),sum为ID号(必须为三位),每种以空格分开,在""中(最多20种)
SALE      ---- 卖物品
INITFIGHT f0 f1 f2 f3 f4 f5 f6 f7 scrb scrl scrr---- 初始化随即战斗参数并开启随机战斗,f0-f7为可能出现的敌人的种类(0为没有),scrb为大战斗背景,scrl为左下角图,scrr为右上角图;逃跑可能成功
FIGHTENABLE     ---- 开启随机战斗
FIGHTDISENABLE     ---- 关闭随机战斗
ENTERFIGHT roundmax f0 f1 f2 scrb scrl scrr evtrnd0 evtrnd1 evtrnd2 evt0 evt1 evt2 lossto winto ---- 进入战斗,roundmax为限定最多回合数(0为无限),f0-f2为敌人(0为没有),evtrnd0-evtrnd2为战斗触发事件回合,evt0-evt2为相应的事件号(用GUTEVENT命令触发),lossto为战斗失败时跳转到的地址标号,winto为战斗胜利时跳转到的地址标号,到达roundmax后不跳转,scrb为大战斗背景,scrl为左下角图,scrr为右上角图;逃跑不能成功
LEARNMAGIC actor type index   ---- 号码actor的主角学会法术类型为type,序号为index的法术
DELETEGOODS type index erradr   ---- 删除物品链中的物品(type,index),如果物品链中无此物品即跳到erradr处执行
ACTORLAYERUP id level    ---- 角色id升到第level级,如果现级别大于或等于level则不升级
DISABLESAVE     ---- 禁止存档功能
ENABLESAVE     ---- 允许存档功能
GAMESAVE     ---- 调用存档功能(这个命令最好不用,因为读档时不会执行GAMESAVE下面的命令,所以会造成错误,尤其是在CALLCHAPTER下时读取就当机了.非要用时就在GAMESAVE下写CALLBACK吧---因为我们都会手动存档,所以这个命令就不要了吧)
SETEVENTTIMER event timer   ---- 定时触发事件event,定时时间为timer*0.5秒,可惜的是不能同时调用(但我有一个方法,把触发次数放在变量中,用变量触发,Clear?)
ENABLESHOWPOS     ---- 打开显示主角在当前地图的坐标功能
DISABLESHOWPOS     ---- 取消显示主角在当前地图的坐标功能
SETARMSTOSS flag    ---- 设置武器是否能投掷(flag为0不能投掷,为1能投掷)
SETFIGHTMISS flag    ---- 设置战斗中是否有Miss(flag为0没有Miss,为1有Miss)
@=========物品操作=========
GAINGOODS type index    ---- 获得物品,类型为type,号码为index
USEGOODS type index erradr   ---- 使用物品链中的一个物品(type,index),如果物品链中无此物品即跳到erradr处执行
USEGOODSNUM type index num erradr  ---- 使用物品链中的num个物品(type,index),如果物品链中无此物品或该物品个数小于num,即跳到erradr处执行且物品链中物品不变
@=========事件和变量操作=========
SETEVENT n     ---- 将事件n标志设置为1
CLREVENT n     ---- 将事件n标志设置为0
SET n m      ---- 脚标号为n的变量内容为m
ADD n m      ---- 脚标号为n的变量与数m相加,结果存到脚标号为n的变量中
SUB n m      ---- 脚标号为n的变量减去数m,结果存到脚标号为n的变量中
SETTO n1 n2     ---- 将变量n1的值赋给变量n2
@=========选择菜单=========
CHOICE "..." "..." adress   ---- 两项选择框,选择第一个不跳转,选择第二个脚本跳转到地址adress处(""中的字符数为9个汉字或19个ASCII字符)
MENU choice "......"    ---- 多项选择菜单,"......"为菜单项字符,项与项间以空格分开(如"离开 继续前进 瞬移"),项数不限;选择结果存放在脚标号为choice的变量中,0为跳出没选择,其他值为选中项序号
@=========角色属性检测和修改=========
ATTRIBTEST actor type attrval lowaddr higaddr ---- 检测号码actor的主角的type(0-级别,1-攻击力,2-防御力,3-身法,4-生命,5-真气当前值,6-当前经验值,7-灵力,8-幸运,9-攻击的异常回合数,10-对特殊状态的免疫,11-普通攻击可能产生异常状态,12-合体法术,13-每回合变化生命,14-每回合变化真气,15-头戴,16-身穿,17-肩披,18-护腕,19-手持,20-脚蹬,21-佩戴1,22-佩戴2,23-生命上限,24-真气上限)属性,属性值小于attrval跳到lowaddr执行脚本,属性值大于attrval跳到higaddr执行脚本,等于不跳转.
ATTRIBSET actor type attrval   ---- 设置号码actor的主角的type(0-级别,1-攻击力,2-防御力,3-身法,4-生命,5-真气当前值,6-当前经验值,7-灵力,8-幸运,9-攻击的异常回合数,10-对特殊状态的免疫,11-普通攻击可能产生异常状态,12-合体法术,13-每回合变化生命,14-每回合变化真气,15-生命上限,16-真气上限)属性,属性值等于attrval.
ATTRIBADD actor type attrval   ---- 号码actor的主角的type(0-级别,1-攻击力,2-防御力,3-身法,4-生命,5-真气当前值,6-当前经验值,7-灵力,8-幸运,9-攻击的异常回合数,10-生命上限,11-真气上限)属性值加上attrval.
RESUMEACTORHP id rade    ---- 恢复角色id生命rade%(一般用于剧情战斗失败,而游戏继续)
TESTMONEY money lessadr    ---- 检测玩家金钱,如果金钱少于money,即跳到lessadr处执行(使用前别忘了检测)
TESTGOODSNUM type index num adrequ adrmore ---- 检测物品链中的物品(type,index)的个数,如果物品链中无此物品或该物品个数小于num,即不跳转;如果个数等于num,跳到adrequ处执行;如果个数大于num,跳到adrmore处执行.
@=========显示信息=========
SHOWGUT toppic botpic "......"   ---- 显示字幕,toppic和botpic为字幕"......"的上下加修饰的图片号
MESSAGE "..."     ---- 用消息框显示"..."中信息(每行最多显示8个汉字,最多可显示5行),等待按键才返回
TIMEMSG time "......"    ---- 用消息框显示"......"中信息(每行最多显示8个汉字,最多可显示5行),延时time*10毫秒,如果time为0则要按键才显示结束.
SAY pos "......"    ---- 将"......"中的内容打印到屏幕上,pos为说话的头像图号(第一幅),0为没有贴图
@=========杂类指令=========
RANDRADE rade trueadr    ---- 产生1000份之rade的随机机率,如果命中,即跳到trueadr处执行,没有命中不跳转
@-------------------------------------------------------脚本命令结束------------------------------------------------------
3.提高篇:
    以下讲解难度高的脚本
    (1)显示精确数值(可以直接运用在脚本内):
@------------------------------以下内容为脚本代码(摘抄自<在RPG游戏中显示精确的数值!!!.txt>)---------------------------------
@初始化变量的值
set 200 0   @将百十个上的数值依次赋值再将其显示出来
set 201 0   @记录百位上的数值
set 202 0   @记录十位上的数值
set 203 0   @记录个位上的数值
set 204 0   @百位标志,1有0空
set 205 0   @十位标志,1有0空
set 206 0   @个位标志,1有0空
set 207 0   @显示单位标志(1为百,2为十)
set 208 0   @记录百位或十位是否有数
@计算各位上的数值
计算百位:
discmp 199 100 计算十位 百位处理
百位处理:
sub 199 100
add 201 1
set 204 1
goto 计算百位
计算十位:
discmp 199 10 计算个位 十位处理
十位处理:
sub 199 10
add 202 1
set 205 1
goto 计算十位
计算个位:
discmp 199 1 显示百位 个位处理
个位处理:
sub 199 1
add 203 1
set 206 1
goto 计算个位
@显示数值
显示百位:
ifcmp 204 0 显示十位
setto 201 200
set 207 1
set 208 1
goto 显示
显示十位:
ifcmp 205 1 必须显示十位
ifcmp 208 0 显示个位
ifcmp 206 1 必须显示十位
callback
必须显示十位:
setto 202 200
set 207 2
set 208 1
goto 显示
显示个位:
ifcmp 206 1 必须显示个位
ifcmp 208 0 必须显示个位
callback
必须显示个位:
setto 203 200
set 207 0
显示:
ifcmp 200 0 显示零
ifcmp 200 1 显示一
ifcmp 200 2 显示二
ifcmp 200 3 显示三
ifcmp 200 4 显示四
ifcmp 200 5 显示五
ifcmp 200 6 显示六
ifcmp 200 7 显示七
ifcmp 200 8 显示八
ifcmp 200 9 显示九
显示零:
message "零"
goto 返回
显示一:
message "一"
goto 显示单位
显示二:
message "二"
goto 显示单位
显示三:
message "三"
goto 显示单位
显示四:
message "四"
goto 显示单位
显示五:
message "五"
goto 显示单位
显示六:
message "六"
goto 显示单位
显示七:
message "七"
goto 显示单位
显示八:
message "八"
goto 显示单位
显示九:
message "九"
goto 显示单位
显示单位:
ifcmp 207 1 显示百
ifcmp 207 2 显示十
callback
显示百:
message "百"
goto 显示十位
显示十:
message "十"
goto 显示个位
返回:
ifcmp 207 1 显示十位
ifcmp 207 2 显示个位
callback
@-------------------------------------------------------脚本代码结束-------------------------------------------------------
    199的变量是一个要显示的数,它是全局变量,进入不同的脚本它的值是不会改变的,我们可以利用它的这一特点将要显示的变量的值赋予它,再调用上面的脚本把它显示出来就可以啦!
    例如上面脚本的类型为m,号码为n,要在游戏中显示出脚标号为188的变量的值,可用类似下面的代码实现:
@-----------------------------------------------------以下内容为脚本代码----------------------------------------------------
message "188号变量的值为:"
setto 188 199
callchapter m n
@-------------------------------------------------------脚本代码结束-------------------------------------------------------
    这样就方便多了.
    (2)如下图:想要制作顺时针转3圈,逆时针转3圈然后触发事件代码(玩家初始位置在地图事件1,地图事件2紧接在地图事件1上,地图事件3紧接在地图事件1左,且闭合通道最好只能通过一人的宽度):
         /----------------------/
        /                      /
       /   /--------------/   /
      /   /   /   /
     /   /         /   /
    /   /--------------/ 2 /
   /                  3 1 /
  ------------------------
@-----------------------------------------------------以下内容为脚本代码(摘抄自<梦幻校园>)----------------------------------
gutevent 41 触发1
触发1:
IF 3 返回
IF 4 返回
IF 1 顺时转
IF 2 逆时转
返回:
SET 5 0  @变量5记录顺逆圈数
CLREVENT 1
CLREVENT 2
CLREVENT 3
CLREVENT 4
MESSAGE "返回"
CALLBACK
顺时转:
CLREVENT 1
IFCMP 5 1 成3
IFCMP 5 2 成4
IFCMP 5 3 返回
SET 5 1
MESSAGE "顺时转一圈"
CALLBACK
成3:
SET 5 2
MESSAGE "顺时转二圈"
CALLBACK
成4:
SET 5 3
MESSAGE "顺时转三圈"
CALLBACK
逆时转:
CLREVENT 2
IFCMP 5 3 成1
IFCMP 5 4 成2
IFCMP 5 5 成功
MESSAGE "逆时转一圈"
GOTO 返回
成1:
SET 5 4
MESSAGE "逆时转一圈"
CALLBACK
成2:
SET 5 5
MESSAGE "逆时转二圈"
CALLBACK
GUTEVENT 42 触发2
触发2:
IF 1 锁1
SETEVENT 2
SETEVENT 3
CALLBACK
锁1:
CLREVENT 4
CALLBACK
GUTEVENT 43 触发3
触发3:
IF 2 锁2
SETEVENT 1
SETEVENT 4
CALLBACK
锁2:
CLREVENT 3
CALLBACK
成功:
IF 5 返回  @事件6记录成功事件是否发生过
MESSAGE "逆时转三圈"
MESSAGE "成功"
SETEVENT 5 @记录成功事件发生过成功事件,以后就不可触发
CALLBACK
@-------------------------------------------------------脚本代码结束-------------------------------------------------------
    也可以转它十几二十次,只需改一下变量5.增加圈数即可.
    另外,发现这个太复杂了,其实有两个变量和两个事件来控制就简单了,大家可以自己尝试.
    (3)顺序触发(就是按顺序触发,否则就重来)
@-----------------------------------------------------以下内容为脚本代码(摘抄自<梦幻校园>)----------------------------------
井1:
IF 25 开1
CALLBACK
开1:
MESSAGE "机关一触发!"
IF 23 触发失败
IF 24 触发失败
SETEVENT 22
CALLBACK
井2:
IF 25 开2
CALLBACK
开2:
MESSAGE "机关二触发!"
IF 22 开21
GOTO 触发失败
开21:
IF 23 触发失败
IF 24 触发失败
SETEVENT 23
CALLBACK
井3:
IF 25 开3
CALLBACK
开3:
MESSAGE "机关三触发!"
IF 23 开31
GOTO 触发失败
开31:
IF 24 触发失败
SETEVENT 24
CALLBACK
井4:
IF 25 开4
CALLBACK
开4:
MESSAGE "机关四触发!"
IF 24 成功1
GOTO 触发失败
成功1:
SAY 2 "快去中心草坪!"
SAY 1 "哦...好!"
CLREVENT 25
SETEVENT 26
CALLBACK
触发失败:
MESSAGE "触发失败!"
SAY 1 "唉,又要重新来一遍..."
CLREVENT 22
CLREVENT 23
CLREVENT 24
CALLBACK
@-------------------------------------------------------脚本代码结束-------------------------------------------------------
    这个比较复杂,其实可以用变量更简单的.我再说一下时间触发事件的技巧.
    (3)时间触发
    我在梦幻校园中加入4个时间事件:饮食,睡觉,泡点和战斗(以后有),在脚本中只能存在一个时间触发,比如我写了两个SETEVENTTIMER,后面的把前面的覆盖了,没有了.看来只能加在一块.想了想,应该定义一个最小时间,然后用变量值来确定是否触发,也就是说,可以定义几个变量分别来指向几个时间事件,每次到最小时间给每个变量加1,到达指定值后触发,事件所需时间就是变量值*最小时间.请看例子:
@------------------------------------------以下内容为脚本代码(摘抄自<梦幻校园>和<校园传奇>)----------------------------------
seteventtimer 250 60  @(这个一定要加,除非你只想触发一次)
IF 500 泡点
晚上:
IF 251 时间战
IFCMP 9 5 睡觉
ADD 9 1
时间战:
IF 42 战斗
GOTO 饮食
战斗:
IFCMP 10 2 开战
ADD 10 1
GOTO 饮食
开战:
SAY 0 "众人:啊哈,被我抓住了.交出古图!"
SET 10 0
ENTERFIGHT 0 14 15 14 6 7 8 0 0 0 0 0 0 输 赢
输:
SAY 0 "众人:拿来吧!"
MESSAGE "古图被抢走,剧情完."
GAMEOVER
CALLBACK
赢:
SAY 1 "快跑啊,否则又会被追上..."
饮食:
ifcmp 39 0 饿
ifcmp 40 0 渴
sub 39 5
sub 40 5
DISCMP 39 20 饿2 检渴
饿2:
say 0 "提示：警告！"
SAY 1 "哎呀,好饿,还是去食堂买点东西吃吧."
检渴:
DISCMP 40 20 渴2 无
渴2:
say 0 "系统提示：警告！"
SAY 1 "哎呀,好渴,还是去食堂买一瓶水喝吧."
无:
return
睡觉:
MESSAGE "夜深了..."
SAY 1 "哈啊~~~,瞌睡死了.去睡觉吧..."
DELALLNPC
SETEVENT 251
SET 9 0
GOTO 时间战
饿:
SAY 0 "系统提示:你饿死了."
GAMEOVER
CALLBACK
渴:
SAY 0 "系统提示:你渴死了."
GAMEOVER
CALLBACK
泡点:
TESTMONEY 500 没钱
USEMONEY 500
ATTRIBADD 1 6 1000
ADD 6 2
SAY 0 "提示:你的属性增加了."
GOTO 晚上
没钱:
SAY 0 "提示:由于你钱不足,泡点功能自动关闭."
CLREVENT 500
GOTO 晚上
@-------------------------------------------------------脚本代码结束-------------------------------------------------------
    睡觉功能指当在晚上时,除主角外所有NPC与场景对象都消失,睡觉后再出现.这里注意要记住4个地方:1,到晚上时开启一个事件;2,睡觉后关闭此事件;3,所有地图脚本的前端加上IF语句,睡觉事件开启时跳到其他地方执行DELALLNPC命令,睡觉事件关闭时往下不变;4,所有地图脚本最后加上触发时间事件号(例如GUTEVENT 250 事件,250为SETEVENTTIMER中的事件号,详细看<校园传奇>脚本.
    我修正了一个BUG,在<校园传奇>中当你剩50点食物和饮水时练功,食物和饮水就会为0,此时再减去5的话就会为负(大约是60000左右),所以就不吃饭喝水也死不了了,而且只能显示0.上面脚本代码是修正过的,不仅可以警告食物少,也可以警告饮水少(<校园传奇>中食物少时不能警告饮水少),而且少于20的都警告而不是只等于20警告(有一次我忘了加挂掉了,而且打了好久没有存档...).
    进入正题,每过30秒触发一次脚本,每过2.5分钟谁一次觉,我把触发一次脚本就给变量9,当变量9为5时触发睡觉事件,并使变量9归0重新开始记,这样就可以实现不同时间来触发事件,时间战斗也一样.
    (4)不同地点可引发随机战斗
    这个比较简单,大家看看<梦幻校园>或<校园传奇>的地图和脚本就可以了,但有一个BUG.大家知道ENTER键吧?可以触发离你还有一格的事件,所以在<校园传奇>中草坪外对草坪按ENTER,到哪你都会遇到随机敌人,解决方法难说,看看<梦幻校园>地图就可以了.还有,<校园传奇>中草坪到处都是随机敌人记号,其实不必如此,只需在入口处标记即可,大大的方便呀.
    (5)踢人(见<梦幻校园>)
    没什么,只是加人去人时记着把事件标好,再调用.
    (6)要想游戏更加好玩,我建议加上游戏难度选择(就是开始时可以选择难度),把选择结果放在变量中调用;或者游戏难度随主角升级而增加,那就要每发生战斗前加上ATTRIBTEST命令了(我很想在<梦幻校园>中加入的,可惜没有时间).
    (7)次数触发
    顾名思义,就是做几次事后触发事件,用到变量.类如:
@-----------------------------------------------------以下内容为脚本代码(摘抄自<梦幻校园>)----------------------------------
ADD 8 1
IFCMP 8 10 奖
CALLBACK
奖:
SAY 0 "波波:谢谢,我送你一张宠物卡,可以帮你战斗哦."
GAINGOODS 14 2
CALLBACK
@-------------------------------------------------------脚本代码结束-------------------------------------------------------
    (8)变量使用方法
    变量只是用来存数字的,然后根据数字的值来跳转至相应事件.现在普遍用变量做到的有:贯穿整个剧情(比较实用!),存钱,潜能,门派,事件触发(较少用,主要用于按顺序的触发事件类型(如上)和达到一定次数后触发(如上)的类型)等.详细一点就是存钱时给一个指定的变量加1,取钱时减1,为0时没有;潜能使用也一样;门派给编一个号,进哪个门派就给指定的变量设置几,然后要学武功等的门派功能时要检验是否是这个门派的人就在前面加上IFCMP指令就可以了.
    (9)在游戏中显示较好的头像
    RPG开发包中支持头像,但比较小,硬添上去又有些难看.所以不如自己添.但比较麻烦.这里有几个注意事项:
a.say命令后只能跟0;
b.每段对话前都要跟命令movie,这里的特效就是你头像图片做的.设置大小为(推荐值,就是最好的了)40*40,播放秒数2,坐标弄成(8,6),以后在脚本中设置就方便了,在左边显示坐标(0,0),右边显示坐标(104,0).
    (10)如何让主角移动
    其实很简单,主角要是想向上移动,就用screen这个命令让地图向下移动一格.如果做的要逼真,就一格一格的显示,另外,可以加上NPCSTEP这个命令(让左右脚也动),这就更逼真拉.

----------------------------------------------------------------------------------------------------------------------------
二.特定资源说明
    RPG制作工具的帮助文件没有说明这些东西.所以这些是DIY时很重要的资源哦!
1.过场动画序号:
240:攻
241:防
242:速
243:毒
244:乱
245:封
246:眠
247:游戏开发组的商标(片头动画)
248:游戏的名称动画
249:游戏战斗失败后的过场动画
250--255:主菜单显示动画(用于选择),250为开始游戏动画(必须有),251为载入游戏动画(必须有),252以后就自己定拉.
2.杂类图片:
    (1)头像类
1,1--1,X:主角图象,每个8幅(24*8,28*1):静(显示用),喜,怒,笑,哀,惊,小(存档用),静(战斗用);每幅宽度最好24,高度最好28.
注:怎样调用中间的一些图片目前还不清楚,所以一定要调用的话就把这些制成另一个图片ID来用(切记不要与主角的头像图片ID重复了).
    (2)界面显示(默认图片大小:宽*个数,高*个数)
2,1:战斗左下脚界面显示,4幅(40*2,32*2),分别是选中攻击,魔法,其他,合击.
2,2:战斗时底下的属性框(75,27).
2,3:攻击对象头上箭头图象(两幅,有无表示闪烁状态)(16*2,11*1).
2,4:选择人物箭头(4幅,前两幅是该命令自己人中的某人;后两幅是施法给自己人中的某人.都为闪烁状态)(8*4,5*1).
2,5:0到10的数字图片(80,7).
2,6:+号(7,7)不用我说.
2,7:-号(7,3)不用我说.
2,8:消息框左右两面的装饰图片(16,24).
2,9:升级图象(128,96).
2,10:练成(魔法)(114,65).
2,11:状态(120,72).
2,12:状态显示,5幅(8*5,8*1),分别是属性上升,下降,不免疫,免疫(指毒乱封眠),回合(指攻防速).
2,13:死后图象(120,22).
2,14:游戏主菜单显示图片(静态,与主菜单显示动画同时显示,当动画大小大于图片大小时覆盖图片,只显示动画)(159,96).
2,15:存档图象(159,96).
2,16:取档图象(159,96).
2,17:坐标显示框(40,16).
2,18:MISS图片(36,10).
    (3)战斗主角
3,1--3,X:主角战斗图片(16*4,16*3)(静,静,跳,挥,砍,施法1,施法2,放法,防,挨打,累,死)
    (4)剧情显示:在SHOWGUT命令中调用的图片号,自己定.
3.脚本:
0 1--0 4:对应上边主菜单显示动画(0 1对应252,0 2对应253...)的脚本.
0 5:读取进度时调用的脚本
0 6:热键(shift+下:查找键或键盘TAB)
0 7:热键(shift+右:添加键或键盘INSERT)
0 8:热键(shift+上:修改键或键盘的HOME)
0 9:热键(shift+左:删除键或键盘DEL)
1 1:游戏开始载入脚本
255 X(X=1,2...):使用ID=X剧情类道具时触发的脚本
    注意:热键脚本结束时应用"RETURN"命令!主菜单脚本和游戏开始载入脚本结束时应用"RETURN"命令!其它的看情况(使用STARTCHAPTER命令用CALLBACK结束;使用CALLCHAPTER命令用RETURN结束,如果使用CALLCHAPTER而用CALLBACK返回则回导致脚本信息丢失).
4.小技巧:
    用数据整和工具添加数据是不是很麻烦?我教你一招.用文本文档打开DATLIB.CFG,在最后一行添加:
全部
*
*
    保存,打开数据整和工具选择全部类型,是不是很方便了?切记是最后一行,否则就会出错,因为它是按顺序识别的.
----------------------------------------------------------------------------------------------------------------------------
三.编译脚本
    其他工具说明可以看帮助文件,我说明一下脚本编译方法.
    1.已经做好一个TXT类型的脚本文件,把它与test.exe和SETGUT.EXE放在同一文件夹中.
    2.执行test.exe,输入你的TXT脚本文件名后回车(包括后缀名),此时会生成4个文件.
    3.删除不必要的文件(后缀名为BIN.HEX.LST),保留GUT文件.
    4.新建一个文本文当,输入:setgut 参数1 参数2 参数3 参数4 参数5,然后保存为BAT格式文件并执行.
格式说明:
    setgut 参数1(输入文件*.gut) 参数2(输出文件*.gut) 参数3(type) 参数4(index) 参数5(说明)
    输入文件和输出文件目录不可一样;不同脚本文件同一type下index不可一样;说明可随便写.
    新生成的GUT文件就是编译好的脚本文件.
    如果想方便一点的话在BAT文件里直接写:
test 文件名1.txt
test 文件名2.txt
...
del *.bin
del *.hex
del *.lst
setgut 参数1 参数2 参数3 参数4 参数5
setgut 参数1 参数2 参数3 参数4 参数5
...
del *.gut   (这个是删除以前的GUT文件,注意其对应的目录)
pause   (加这个是为了错误时能找到错误行数)
类如:
test 1-1.txt
test 1-2.txt
...
del *.bin
del *.hex
del *.lst
setgut 1-1.gut gut\1-1.gut 1 1 游戏开始
setgut 1-2.gut gut\1-2.gut 1 2 游戏开始
...
del *.gut
pause
    这样第2步和第2步以后就可省略了.
四.错误说明
    1.若编译脚本时显示XX行错误,那就跳到XX行看是否语句输错,但有时不行,那就要看看标点符号是否为半角的英文符号,类如冒号(:)引号(")等.还要看看是否有多余的空格键(RPG脚本编辑器中总是在句尾加一空格使之不能被识别编译,删去就好了),注意每个脚本写完要加一回车键.
    2.图片编码的透明色选择时稍微向下点,可能没编好害的我找的好苦.
    3.显示字幕时出现好多乱码而且完不了,这时你应该看一下引号中的字幕是否够80个ASCII码或40个汉字,我试了好多遍才试出来要至少这么多字才能正常.还有屏幕一行可显示20个ASCII码或10个汉字(否则有时会显示乱码),大家把握好美观.一个一个数太麻烦,我有一招,把记事本宽度拉到正好显示20个ASCII码的宽度就OK了(重起一行写,因为前面有SHOWGUT几个占位置,然后把写好的加在后面),前提是选中"自动换行".为了简化,我写了个字幕排版程序,但只支持全角.
    4.因为数据整和工具有问题(好象就是替换右方框的数据时就会出错),要么替换时先删除,要么重做.问题就会解决.
    5.地图事件所在地不能有NPC,否则NPC不能对话了.
五.补充说明
    其他开发包内工具可以看开发包帮助,但我再唠叨几句:
    1.角色编辑器基本资源中,面向(创建角色时角色的默认面向,可以在脚本中设置),脚步(创建角色时角色的默认脚步,也可以在脚本中设置),动作(1,2,3效果一样,都是随即行动),延时(动作为1,2或3时必添,意为多长时间后移动一次,脚本中不能设置,所以建议添上,除非对象在整个游戏中都不动).
    2.RunErr7在帮助中说明错了,可以删除ID>3的角色(不然ID>3的角色就踢不掉了);还有一条就是删除了不存在的主角ID.
    3.SETARMSTOSS和SETFIGHTMISS命令在模拟时不可使用!不然屏幕底下就会闪一下乱码就翘了(电子词典上要用新的编译器,我的网站上有).
    4.大家使用什么东西时(例如金钱,物品)时,一定要先检测,否则东西为0时也可以使用,然后就出错了.
    5.地图编辑器中LOAD与POS区别:它们的横坐标差4,纵坐标差3,读入地图时用LOAD坐标(也就是主角所在地图位置,相对于屏幕最左上角多了(4,3));创建NPC,场景对象等时用POS坐标.
    6.某些道具说明:
(1)当使用土遁类道具时,会触发当前执行脚本的第255号事件.就是在当前脚本中加入 gutevent 255 地址.
(2)使用剧情类道具时,配合脚本使用(ID=1对应脚本序号 255 1,ID=2对应脚本序号 255 2,...)，注意脚本中用RETURN返回.
    7.游戏中的金钱,真气,生命,攻击,防御,身法,灵力,幸运等都为变量.
    8.发现一个大BUG,就是每次在不退出游戏的情况下新开始游戏变量竟然不初始化!这样即给我们带来了方便,又带来了麻烦...所以要去除这个BUG的方法就是写游戏的开始脚本时把用到的变量都清为0.
    9.攻击防御生命真气我就不说了,补充一点就是:杀伤力=攻击力-防御力±偏移量(偏移量是随机的).
    10.身法:与攻击先后和躲避几率有关.
       灵力:与魔法的杀伤力和防御魔法有关.
       幸运:与免疫几率有关.
你要问我上三个的具体内容,我会回答我也不知道,我也测试了许久才知道上面的相关.不知作者怎么搞的,敌人灵力设置成99还会一招就秒!!再把自己的法往高提,杀伤力又成了1??!!所以我想,最好都弄低一点,可能是溢出的错误导致.我看这个开发包要好好修正一下了(除非这种游戏还没过时...).
    11.一个好的游戏不仅仅要有好的界面,也要有好的剧情和适当的难易度.另外,代码的美观简洁也是很重要的,不然以后修改自己的BUG或者增加游戏功能时看不懂了就麻烦了.

----------------------------------------------------------------------------------------------------------------------------
    这费了我好多时间,希望对大家有所帮助!
 我的联系方式:
  QQ:85885245(请注明来意)
  E-mail: pleafles@QQ.com
   pleafles@163.com
   鹰歌联盟聊天群:请注意网站说明。
 鹰歌联盟网站:  http://leamus.9966.org
 鹰歌联盟文件下载空间: http://leamus.go.9966.org
 鹰歌联盟文件上传空间: http://leamus.ys168.com
 鹰歌联盟临时1:  http://leamus.to.9966.org
 鹰歌联盟临时2:  http://leamus.at.9966.org

----------------------------------------------------------------------------------------------------------------------------
    注意!若要引用或使用本软件代码或段落请在使用代码处注明软件作者和出处.鄙视剽窃行为!
----------------------------------------------------------------------------------------------------------------------------
         --- 深林孤鹰  